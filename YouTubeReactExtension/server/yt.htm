<!DOCTYPE html>
<!-- To interface with SuperMemo you must preserve these properties and fields when editing yt.htm:
    - the order of INPUT fields (these are used by SuperMemo to collect extract boundaries)
    - SELECT and OPTION fields for generating extracts
    - INPUT field with YouTube video ID substituted by SuperMemo (id="videoid")
    - INPUT field that determines the position of video start and end (id="startvideoat" and id="stopvideoat")(must be "0:00:00")
    see: https://help.supermemo.org/wiki/Incremental_video#Your_own_incremental_video_script
    Symptoms of failure to do this: extract start nd stop times are rotated incorrctly (start becomes stop)
-->
<html><head>
    <meta http-equiv="content-type" content="text/html; charset=windows-1252">
        <meta content="IE=11.0000" http-equiv="X-UA-Compatible">
        <style type="text/css">
            body, div, h4, p, input, select {
                margin: 0;
                padding: 0;
            }

            img {
                margin: 0 2px;
            }

            #ga {
                display: none;
            }

            #feedbackOuter {
                margin: 5px;
                display: none;
                width: 415px;
                text-align: center;
            }

            .img-yellow-message-top-cap, .img-yellow-message-bottom-cap {
                height: 4px;
                font-size: 0;
            }

            .img-yellow-message-top-cap {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat 0 -32px;
            }

            .left-right-border-yellow {
                border-left: 1px solid #F5E082;
                border-right: 1px solid #F5E082;
                background-color: #FFFFE5;
            }

            .img-yellow-message-bottom-cap {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat 0 -36px;
            }

            #feedbackInner {
                padding: 5px;
                text-align: left;
            }

            h4 {
                padding-left: 17px;
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -401px 1px;
            }

            .bd {
                margin: 5px 0;
            }

            .ft {
                text-align: center;
            }

            .email {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat 0 0;
            }

            fieldset {
                padding: 5px;
                border: none;
                display: block;
                width: 800px;
            }

            p {
                margin: 0;
                padding: 0;
            }

            .ctrlGrp {
                border-top: 1px solid #808080;
                clear: both;
            }

            .ctrlSubgrp {
                padding: 5px;
                border-left: 1px solid #808080;
                float: left;
            }

            .firstCtrlGrp, .firstCtrlSubgrp {
                border: none;
            }

            .debug {
                font-size: xx-small;
            }

            .repeat {
                float: left;
                height: 3.6em;
            }

            button, input {
                width: 5em;
            }

            .checkbox {
                width: auto;
            }

            select, #extractName {
                width: 15em;
            }

            a span {
                height: 16px;
                width: 16px;
                font-size: 0;
            }

            .ctrlGrp label {
                display: block;
                width: auto;
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -254px 0;
            }

            .imgBtn {
                border: 0;
                width: 16px;
                vertical-align: text-top;
            }

            .rewind {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -16px 0;
            }

            .forward {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -32px 0;
            }

            .goTo {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -48px 0;
            }

            .restoreStartAt {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -64px 0;
            }

            .restoreStopAt {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -80px 0;
            }

            .removeCurrentExtract {
                background: transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -96px 0;
            }
			
			.videoWrapper {
				position: relative;
				padding-bottom: 56.25%; /* 16:9 */
				padding-top: 25px;
				height: 0;
			}
			.videoWrapper iframe {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
			}
        </style>
        <link href="http://localhost:8000/scripts/container.css" type="text/css" rel="stylesheet" />
    </head>
    <body class="yui-skin-sam">
        <div id="customPrompt">
            <div class="hd">Save As</div>
            <div class="bd">
                <form name="promptForm" id="promptForm">
                    <label for="extractName">Extract name: </label>
                    <input type="text" name="extractName" id="extractName" onfocus="this.select();" onblur="oCustomPrompt.focusFirstButton();" />
                </form>
            </div>
        </div>
        <div id="feedbackOuter">
            <div class="img-yellow-message-top-cap"></div>
            <div class="left-right-border-yellow">
                <div id="feedbackInner"></div>
            </div>
            <div class="img-yellow-message-bottom-cap"></div>
        </div>
        <div class="videoWrapper">
			<div id="bideo"></div>
		</div>
        <input type="hidden" value="zzzYT-IDzzz" id="videoid" />
        <input type="hidden" value="1" id="imposeboundries" />
        <fieldset>      
            <div class="ctrlGrp firstCtrlGrp">
                <div class="ctrlSubgrp firstCtrlSubgrp">
                    <p>
                        <button type="button" id="mark" onclick="setAt('resume');"> [ Mark ]</button>
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="" id="rewindResume" class="imgBtn rewind" onclick="move('resume', 'rewind');" />
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="Go to" title="Go to" id="resume" class="imgBtn goTo" onclick="resumeVideo();" />
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="" id="forwardResume" class="imgBtn forward" onclick="move('resume', 'forward');" />
						<input type="textarea" value="0:00:00" id="resumevideoat" onfocus="this.select();" ondblclick="resetAt('resume');" onchange="this.value = convertDuration2HHMMSS(convertHHMMSS2Duration(this.value));" onclick="setAt('resume');" onscroll="console.log('scroll');"/>
						<img src="http://localhost:8000/iv/images/transparent.png" alt="Restore default" title="Restore default" id="restoreResumeAt" class="imgBtn restoreStartAt" onclick="resetAt('resume');" />
                        |
                        <button type="button" id="start" onclick="setAt('start');" title="Set clip start">[</button>
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="" id="rewindStart" class="imgBtn rewind" onclick="move('start', 'rewind');" />
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="Go to" title="Go to" id="goToStart" class="imgBtn goTo" onclick="goTo('start');" />
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="" id="forwardStart" class="imgBtn forward" onclick="move('start', 'forward');" />
                        <input type="text" value="0:00:00" id="startvideoat" onfocus="this.select();" onchange="this.value = convertDuration2HHMMSS(convertHHMMSS2Duration(this.value)); var that = this; imposeBoundaries(0, that);" onclick="setAt('start');this.select();" ondblclick="resetAt('start');this.select();" />
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="Restore default" title="Restore default" id="restoreStartAt" class="imgBtn restoreStartAt" onclick="resetAt('start');" />
                        ~
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="Restore default" title="Restore default" id="restoreStopAt" class="imgBtn restoreStopAt" onclick="resetAt('stop');" />
                        <input type="text" value="0:00:00" id="stopvideoat" onfocus="this.select();" onchange="this.value = convertDuration2HHMMSS(convertHHMMSS2Duration(this.value)); var that = this; imposeBoundaries(0, that);" onclick="setAt('stop');this.select();" ondblclick="resetAt('stop');" />
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="" id="rewindStop" class="imgBtn rewind" onclick="move('stop', 'rewind');" />
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="Go to" title="Go to" id="goToStop" class="imgBtn goTo" onclick="goTo('stop');" />
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="" id="forwardStop" class="imgBtn forward" onclick="move('stop', 'forward');" />
                        <button type="button" id="stop" onclick="setAt('stop');" title="Set clip end">]</button>
                    </p>
                </div>
            </div>
            <div class="ctrlGrp">
                <div class="ctrlSubgrp repeat">
                    <p>
                        <input type="checkbox" checked="checked" id="repeat" class="checkbox" />
                        <label for="repeat" title="Repeat (R)">&nbsp;</label>
                    </p>
                </div>
                <div class="ctrlSubgrp">
                    <p>
                        <button type="button" id="test" onclick="testExtract();">Test</button>
                        <button type="button" id="reset" onclick="resetExtract();">Reset</button>
                        <button type="button" id="extract" onclick="addExtract();">Extract</button>
                        <select id="extracts" onchange="feedCurrentExtract();" onclick="feedCurrentExtract();"></select>
                        <img src="http://localhost:8000/iv/images/transparent.png" alt="Remove the currently selected extract" id="removeCurrentExtract" class="imgBtn removeCurrentExtract" onclick="removeCurrentExtract();" />
                    </p>
                </div>
            </div>
            <!-- <button type="button" id="scloud" onclick="loadSoundcloudPlayer();">Soundcloud</button> -->
            <!-- <button type="button" id="vyp" onclick="loadVidyardPlayer();">Vidyard</button> -->
            <!-- <button type="button" id="rawmp4" onclick="loadRawPlayer();">MP4</button> -->
            <!-- <button type="button" id="edge" onclick="openEdge();">Edge</button> -->
            <button type="button" id="back" onclick="prevElement();" disabled>Back</button>
            <button type="button" id="learn" onclick="beginLearning();" disabled>Learn</button>
            <button type="button" id="rep" onclick="nextRep();" disabled>Rep</button>
            <button type="button" id="fwd" onclick="nextElement();" disabled>Fwd</button>
			<div class="ctrlGrp">
                <textarea id="log" style="width: 100%"></textarea>
			</div>
            <div class="ctrlGrp">
                <div class="ctrlSubgrp firstCtrlSubgrp debug">Date: Nov 29, 2017</div>
            </div>
			<input type="hidden" value="0" id="customPromptVisible" />
        </fieldset>
        <div id="speedSlider" style="z-index:2;">
        <form>
        <div>
            <input 
            type="range" 
            min=-10
            max=10
            value=0
            id="fader"
            step=1
            onchange="outputUpdate(value)"
            >
            <span for=fader id=speed>1</span>
        </div>
        </form>
        </div>

        <!-- YAHOO -->
        <script type="text/javascript" src="http://localhost:8000/scripts/container-min.js" defer onload="setTimeout(loadBindings,0)"></script>
        
        <!-- <script type="text/javascript" src='http://localhost:8000/node_modules/@babel/polyfill/dist/polyfill.min.js'></script> -->
        <!-- http://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js -->
        <script src="http://localhost:8000/scripts/polyfill.min.js"></script>

        <!-- add support for thumbnail frame fetching, TODO -->
        <!-- <script type="text/javascript" src='http://github.com/github/fetch/releases/download/v3.4.1/fetch.umd.js'></script> -->

        <!-- http://unpkg.com/react-player/dist/ReactPlayer.standalone.js -->
        <script type="text/javascript" src='http://localhost:8000/scripts/ReactPlayer.standalone.js' async onload="setTimeout(loadPlayer,0)"></script>
        <script>
            // define a new console
            var console=(function(oldCons){
                var oLog = document.getElementById("log");
                return {
                    log: function(text){
                        //oldCons.log(text);
                        oLog.innerHTML += '[LOG] ' + text + '\n';                    
                    },
                    info: function (text) {
                        //oldCons.info(text);
                        // Your code
                        oLog.innerHTML += '[INFO] ' + text + '\n';                    
                    },
                    warn: function (text) {
                        //oldCons.warn(text);
                        // Your code
                        oLog.innerHTML += '[WARN] ' + text + '\n';
                        //alert( '[WARN] ' + text + '\n')                
                    },
                    error: function (text) {
                        //oldCons.error(text);
                        // Your code
                        oLog.innerHTML += '[ERROR] ' + text + '\n';                    
                    }
                };
            }(window.console));

            //Then redefine the old console
            window.console = console;

            window.onerror = function myErrorHandler(errorMsg, url, lineNumber) {
                // Log the error here -- perhaps using an AJAX call
                console.error(errorMsg);
                return true;
            }

            function callAjax(url, callback){
                var xmlhttp;
                // compat IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function(){
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
                        callback(xmlhttp.responseText);
                    }
                }
                xmlhttp.open("GET", url, true);
                xmlhttp.send();
            }

            //TODO state loading
            state = {
                url: null,
                pip: false,
                playing: true,
                controls: false,
                light: false,
                volume: 0.8,
                muted: false,
                played: 0,
                loaded: 0,
                duration: 0,
                playbackRate: 1.0,
                loop: false
            }

            IPC_IP = "localhost";
            IPC_PORT = "13000";

            function imposeBoundaries(value, updateElement){
                document.getElementById('imposeboundries').value = value; 
                var that = window.opener;
                if(that && that.syncElement){
                    that.syncElement(that, "imposeboundries", value);
                }

                if(updateElement){
                    updateBorder(updateElement);
                }
            }

            function setAt(type) {
                var oAt,
                    iCurrTime = 0,
                    iDuration = 0;

                if (ytplayer) {
                    iCurrTime = parseInt(ytplayer.getCurrentTime());
                    iDuration = parseInt(ytplayer.getDuration());
                    oAt = document.getElementById(type + "videoat");
                    var cur = convertDuration2HHMMSS(iCurrTime);
                    oAt.value = cur;

                    var that = window.opener;
                    if(that && that.syncElement)
                        that.syncElement(that, type + "videoat", cur)

                    if (type != "resume") {
                        imposeBoundaries(0, oAt);
                    }
                }
            }

            //sets the *videat to either 0 or current play time
            function resetAt(type) {
                var oAt = document.getElementById(type + "videoat"),
                    iAt;
                //console.warn("setting " + type + "videoat, cur: " + oAt.value) 
                switch (type) {
                    case "resume":
                    case "start":
                        //console.warn("   to zero.")
                        iAt = 0;
                        break;

                    case "stop":
                        if (ytplayer) {
                            //console.warn( "    to the duration: " + ytplayer.getDuration())
                            iAt = parseInt(ytplayer.getDuration());
                        }
                        break;
                }

                var conv = convertDuration2HHMMSS(iAt);
                oAt.value = conv
                var that = window.opener;
                if(that && that.syncElement)
                    that.syncElement(that, type + "videoat", conv)

                oAt.style.border = "2px inset";
            }

            //cosmetic
            function updateBorder(inputText) {
                var sBorderCl = "",
                    iNewVal = convertHHMMSS2Duration(inputText.value);

                switch (inputText.id.replace(/videoat/, "")) {
                    case "start":
                        if (iNewVal > 0) {
                            sBorderCl = "blue";
                        }
                        break;

                    case "stop":
                        // TODO use of internal player discouraged
                        if (ytplayer.getInternalPlayer()) {
                            if (ytplayer.getInternalPlayer().getPlayerState() >= 1) {
                                if (iNewVal < parseInt(ytplayer.getDuration())) {
                                    sBorderCl = "blue";
                                }
                            }
                        }
                        break;
                }

                if (sBorderCl.length) {
                    inputText.style.border = "2px solid " + sBorderCl;
                    var that = window.opener; if (that && that.syncBorder)
                        that.syncBorder(that, inputText.id, "2px solid " + sBorderCl);
                } else {
                    inputText.style.border = "2px inset";
                    var that = window.opener; if (that && that.syncBorder)
                        that.syncBorder(that, inputText.id, "2px inset");
                }
            }
 
            function handlePlayerReady(player) {
                ytplayer = player;
                playerElem = document.getElementById("bideo")

                if (1 == document.getElementById("imposeboundries").value) {
                    seekVideo("start");
                } else {
                    seekVideo("resume");
                }
                checkBoundaries();
            }

            function handlePlay(){
                oFeedbackOuter = document.getElementById("feedbackOuter");
                if ("block" == oFeedbackOuter.style.display) {
                    oFeedbackOuter.style.display = "none";
                    document.getElementById("feedbackInner").innerHTML = "";
                    var that = window.opener;
                    if(that && that.syncElement)
                        that.syncInnerHTML(that, "feedbackInner", "");
                }
            }

            function handlePause(){
                imposeBoundaries(0, undefined);
            }

            var arrowListener = function (e) {
                e = e || window.event;

                var keyCode = e.keyCode || e.which;

                //up
                var type = e.target.id.replace("videoat","");
                if(keyCode=='38'){
                    move(type, 'forward'); 
                    e.preventDefault();
                    return false;
                } else if (keyCode=='40'){
                    move(type, 'rewind');
                    e.preventDefault();
                    return false;
                }        
            }


            function seekVideo(to) {
                if (ytplayer) {
                    //console.log('seeking from ' + ytplayer.getCurrentTime() + ' to ' + convertHHMMSS2Duration(document.getElementById(to + "videoat").value))
                    ytplayer.seekTo(convertHHMMSS2Duration(document.getElementById(to + "videoat").value), 'seconds');
                }
            }

            function pausePlayer () {
                //TODO state dynamically
                //renderReactPlayer(container, { url:url, playing: false })
                if(ytplayer.getInternalPlayer()){
                    ytplayer.getInternalPlayer().pauseVideo();
                    return true;
                }
                return false;
            }
            
            function playPlayer () {
                //TODO state dynamically
                //renderReactPlayer(container, { url:url, playing: true })
                if(ytplayer.getInternalPlayer()){
                    ytplayer.getInternalPlayer().playVideo();
                    return true;
                }
                return false;
            }

            function resumeVideo() {
                if (ytplayer) {
                    playPlayer();
                    seekVideo('resume');
                }
            }

            function testExtract() {
                if (ytplayer) {
                    playPlayer();
                    seekVideo("start");
                    imposeBoundaries(1, undefined);
                }
            }

            function resetExtract() {
                if (ytplayer) {
                    imposeBoundaries(0, undefined);
                    resetAt("start");
                    resetAt("stop");
                }
            }

            function addExtract() {
                var oCustomPromptVisible = document.getElementById("customPromptVisible"),
					oExtracts = document.getElementById("extracts"),
                    iNextExtractNo = (!oExtracts.options.length) ? 1 : oExtracts.options.length + 1,
                    sExtractName = "Extract #" + iNextExtractNo;

				oCustomPromptVisible.value = 1;

				if (oCustomPromptVisible.value == 1) {
	                document.getElementById("extractName").value = sExtractName;

					oCustomPrompt.show();

	                oRKeyListener.disable();
                    oFKeyListener.disable();
				}
            }

            // carry out seek based on selected extract option
            function feedCurrentExtract(e) {
                var oEvent = YAHOO.util.Event.getEvent(e),
                    oSelect = document.getElementById("extracts"),
                    sCurrentExtract = "",
                    aCurrentExtract = [],
                    oStartAt = document.getElementById("startvideoat"),
                    oStopAt = document.getElementById("stopvideoat");

                var that = window.opener;
                if(that && that.syncExtractsSelect)
                    that.syncExtractsSelect(that, "extracts", oSelect.selectedIndex); 

                if ((oSelect.options.length > 1) && (oEvent.type == "click")) {
                    YAHOO.util.Event.stopEvent(oEvent);
                    return;
                }

                sCurrentExtract = oSelect.options[oSelect.selectedIndex].value;
                aCurrentExtract = sCurrentExtract.split(" - ");
                //console.log("e Overwriting start " + oStartAt.value + "->" + aCurrentExtract[0])
                oStartAt.value = aCurrentExtract[0];
                var that = window.opener; if(that && that.syncElement)
                    that.syncElement(that, "startvideoat", aCurrentExtract[0]);
                updateBorder(oStartAt);
                oStopAt.value = aCurrentExtract[1];
                var that = window.opener; if(that && that.syncElement)
                    that.syncElement(that, "stopvideoat", aCurrentExtract[1]);
                //console.log("e Overwriting stop " + oStopAt.value + "->" + aCurrentExtract[1])
                updateBorder(oStopAt);
                if (ytplayer) {
                    playPlayer();
                }
                seekVideo("start");
                imposeBoundaries(1, undefined);
                oSelect.blur();
            }

            function removeCurrentExtract() {
                var that = window.opener
                if(that && that.syncExtractsRemove)
                    that.syncExtractsRemove(that, "extracts");
                
                var oExtracts = document.getElementById("extracts"),
                    oCurrentExtract = oExtracts.options[oExtracts.selectedIndex];

                oExtracts.options[oExtracts.selectedIndex] = null;
                if (oExtracts.options.length) {
                    oExtracts.selectedIndex = oExtracts.options.length - 1;
                } else {
                    oExtracts.disabled = true;
                    document.getElementById("removeCurrentExtract").style.background = "transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -96px 0";
                }
            }

            function goTo(type) {
                if (ytplayer) {
                    playPlayer();
                    seekVideo(type);
                    imposeBoundaries(0, undefined);
                }
            }

            function move(type, where) {
                var oAt = document.getElementById(type + "videoat"),
                    iOldVal = convertHHMMSS2Duration(oAt.value),
                    iNewVal = 0,
                    iMaxVal = 0;

                if (ytplayer) {
                    iMaxVal = parseInt(ytplayer.getDuration());
                }

                switch (where) {
                    case "rewind":
                        iNewVal = iOldVal - iSecs;
                        if (iNewVal <= 0) {
                            iNewVal = 0;
                        }
                        if (iNewVal > iMaxVal) {
                            iNewVal = iMaxVal;
                        }
                        break;

                    case "forward":
                        iNewVal = iOldVal + iSecs;
                        if (iNewVal >= iMaxVal) {
                            iNewVal = iMaxVal;
                        }
                        if (iNewVal < 0) {
                            iNewVal = 0;
                        }
                        break;
                }

                var conv = convertDuration2HHMMSS(iNewVal);
                oAt.value = conv
                var that = window.opener
                if(that && that.syncElement)
                    that.syncElement(that, type + "videoat", conv)
                
            }

            //keep player progress within learning boundaries
            function checkBoundaries() {
                var oVideoId = document.getElementById("videoid"),
                    oImposeBoundries = document.getElementById("imposeboundries"),
                    oResumeAt = document.getElementById("resumevideoat"),
                    iResumeAt = convertHHMMSS2Duration(oResumeAt.value),
                    oRewindStart = document.getElementById("rewindStart"),
					oRewindStop = document.getElementById("rewindStop"),
                    sRewindAlt = "Rewind " + iSecs + " Sec.",
                    oStartAt = document.getElementById("startvideoat"),
                    iStartAt = convertHHMMSS2Duration(oStartAt.value),
                    oStopAt = document.getElementById("stopvideoat"),
                    iStopAt = convertHHMMSS2Duration(oStopAt.value),
                    oForwardStart = document.getElementById("forwardStart"),
					oForwardStop = document.getElementById("forwardStop"),
                    sForwardAlt = "Forward " + iSecs + " Sec.",
                    bRepeat = document.getElementById("repeat").checked,
                    fCurrentTime,
                    iDuration,
					oLog = document.getElementById("log");

                if (ytplayer && ytplayer.getInternalPlayer()) {
                    iDuration = parseInt(ytplayer.getDuration());
                    fCurrentTime = ytplayer.getCurrentTime();
                    oRewindStart.title = sRewindAlt;
					oRewindStop.title = sRewindAlt;
					if (!oRewindStart.alt.length) {
                        oRewindStart.alt = sRewindAlt;
                    }
					if (!oRewindStop.alt.length) {
                        oRewindStop.alt = sRewindAlt;
                    }					
                    oForwardStart.title = sForwardAlt;
                    oForwardStop.title = sForwardAlt;
                    if (!oForwardStart.alt.length) {
                        oForwardStart.alt = sForwardAlt;
                    }
                    if (!oForwardStop.alt.length) {
                        oForwardStop.alt = sForwardAlt;
                    }

                    //there was a start check here, maybe it depended on code partially running?    
                    if (-1 != ytplayer.getInternalPlayer().getPlayerState()) {
                        sCurrentVideoUrl = ytplayer.getInternalPlayer().getVideoUrl();
                        sCurrentVideoId = sCurrentVideoUrl.substr(sCurrentVideoUrl.indexOf("v=") + 2, 11);
                        //console.log("url " + sCurrentVideoUrl)
                        //console.log("id " + sCurrentVideoId)
                        //TODO print stuff
                        if ((0 == iResumeAt) 
                            || (sCurrentVideoId != oVideoId.value)
                            ) {
                            console.log("overriding vid (res set to zero) " + oVideoId.value + " with " + sCurrentVideoId)
                            oVideoId.value = sCurrentVideoId;
                            oResumeAt.value = convertDuration2HHMMSS(0);
                        }
                        if ((0 == iStartAt) && (0 == iStopAt) 
                            || (sCurrentVideoId != oVideoId.value)
                            ) {
                            console.log("overriding vid (start/stop reset) " + oVideoId.value + " with " + sCurrentVideoId)
                            oVideoId.value = sCurrentVideoId;
                            resetAt("start");
                            resetAt("stop");
                        }
                        //console.log("active elem " + document.activeElement.id);
                        if (iStartAt > iStopAt) {
                            if (document.activeElement.id != "stopvideoat") {
                                resetAt("stop");
                            }
                        }
                        if (((iStartAt > 0) && (0 == iStopAt)) || ((iStartAt > 0) && (iStopAt > iDuration))) {
                            if (document.activeElement.id != "stopvideoat") {
                                resetAt("stop");
                            }
                        }
                        if (document.activeElement.id != "startvideoat") {
                            updateBorder(oStartAt);
                        }
                        if (document.activeElement.id != "stopvideoat") {
                            updateBorder(oStopAt);
                        }
                        if ((iDuration - fCurrentTime) < 1) {
                            ytplayer.seekTo(iStartAt, 'seconds');
                            if (!bRepeat) {
                                pausePlayer();
                            }
                        }
                        if ((1 == parseInt(oImposeBoundries.value)) && (fCurrentTime >= iStopAt)) {
                            if (bRepeat) {
                                seekVideo("start");
                            } else {
                                pausePlayer();                        
                            }
                        }
                    }
                }
            }

            function handleProgress(state) {
                //console.log('onProgress ' + state);
                //console.log(" " + playerElem)
                // We only want to update time slider if we are not currently seeking
                if (!ytplayer.state.seeking) {
                    ytplayer.setState(state);
                    checkBoundaries();
                }
            }

            function convertDuration2HHMMSS(seconds) {
                var iDuration = parseInt(seconds),
                iTotalMinutes = Math.floor(iDuration / 60),
                iHours = Math.floor(iTotalMinutes / 60),
                iMinutes = iTotalMinutes % 60,
                iSeconds = iDuration % 60;
                
                if (iHours > 0) {
                    //console.log("converting " + seconds + ' to ' +  iHours + ":" + padZero(iMinutes) + ":" + padZero(iSeconds));
                    return iHours + ":" + padZero(iMinutes) + ":" + padZero(iSeconds);
                } else {
                    //console.log("converting " + seconds + ' to ' + iMinutes + ':' + padZero(iSeconds));
                    return iMinutes + ':' + padZero(iSeconds);
                }
            }

            function padZero(number) {
                if (number < 10) {
                    return "0" + number;
                } else {
                    return number;
                }
            }

            function convertHHMMSS2Duration(time) {
                var iTotalSeconds = 0,
                    aTime = time.split(":");

                switch (aTime.length) {
                    case 3:
                        iTotalSeconds += aTime[0] * 60 * 60;
                        iTotalSeconds += aTime[1] * 60;
                        iTotalSeconds += aTime[2] * 1;
                        break;

                    case 2:
                        iTotalSeconds += aTime[0] * 60;
                        iTotalSeconds += aTime[1] * 1;
                        break;

                    default:
                        iTotalSeconds += aTime[0] * 1;
                        break;
                }

                //console.log("converting " + time + ' to ' + iTotalSeconds);
                return iTotalSeconds;
            }

            function ucfirst( str ) {
                // http://kevin.vanzonneveld.net
                // +   original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
                // +   bugfixed by: Onno Marsman
                // +   improved by: Brett Zamir
                // *     example 1: ucfirst('kevin van zonneveld');
                // *     returns 1: 'Kevin van zonneveld'

                str += '';
                var f = str.charAt(0).toUpperCase();
                return f + str.substr(1);
            }

            var parseUrlQuery = function(urlQuery) {
                var aUrlQuery,
                    aUrlParam,
                    oUrlQuery = {};
                
                urlQuery = urlQuery.substring(1);
                
                aUrlQuery = urlQuery.split("&");
                
                for (var i = 0, j = aUrlQuery.length; i < j; i++) {
                    aUrlParam = aUrlQuery[i].split("=");
                    oUrlQuery[aUrlParam[0]] = aUrlParam[1];
                }
                
                return oUrlQuery;
            },
            oUrlQuery = parseUrlQuery(document.location.search),
            iSecs = 1,
            url,
            container,
            ytplayer,
            playerElem,
            oCustomPrompt,
            oRKeyListener,
            oFKeyListener;
            //console.log('?' + (sUrlString.replace("yt.htm","")));
            //console.log(document.location.search);

            function outputUpdate(val) {
                sp = 1+(0.1*val);
                document.getElementById('speed').innerHTML= sp;
                if(ytplayer.getInternalPlayer()){
                    ytplayer.getInternalPlayer().setPlaybackRate(sp);
                }
            }

            function loadBindings(){
                var fOK = function (e) {
	                var oNewOpt,
	                    sExtractName = this.getData().extractName,
	                    oStartAt = document.getElementById("startvideoat"),
	                    oStopAt = document.getElementById("stopvideoat"),
	                    sExtractVal = oStartAt.value + " - " + oStopAt.value,
	                    oExtracts = document.getElementById("extracts"),
	                    oResumeAt = document.getElementById("resumevideoat"),
						oCustomPromptVisible = document.getElementById("customPromptVisible");
                    //console.log('' + sExtractName);

                    // (1) updates [extracts] menu with a new extract
                    oNewOpt = new Option(sExtractName, sExtractVal);
                    oExtracts.options[oExtracts.options.length] = oNewOpt;
                    oExtracts.selectedIndex = oExtracts.options.length - 1;
                    oExtracts.disabled = false;
                    
                    var that = window.opener;
                    if(that && that.syncExtractsAdd)
                        that.syncExtractsAdd(that, "extracts", sExtractName, sExtractVal);

                    document.getElementById("removeCurrentExtract").style.background = "transparent url(http://localhost:8000/iv/images/icons.png) no-repeat -112px 0";
                    // (2) sets [resumevideoat] text input to [stopvideoat]
                    // oResumeAt.value = oStopAt.value;
                    // (3) sets [startvideoat] text input to EXPERIMENTAL Stop - 1 sec.
                    oStartAt.value = convertDuration2HHMMSS(convertHHMMSS2Duration(oStopAt.value) - 1);
                    if(that && that.syncElement)
                        that.syncElement(that, "startvideoat", oStartAt.value);

                    // (4) resets [stopvideoat] text input
                    resetAt("stop");

                    oCustomPromptVisible.value = 0;

					if (oCustomPromptVisible.value == 0) {
						this.hide();

	                    oRKeyListener.enable();
	                    oFKeyListener.enable();
					}
                },
                fCancel = function () {
					var oCustomPromptVisible = document.getElementById("customPromptVisible");

					oCustomPromptVisible.value = 0;

					if (oCustomPromptVisible.value == 0) {
                        oCustomPrompt.cancel();

	                    oRKeyListener.enable();
                        oFKeyListener.enable();
					}
                },
                oCustomPromptCfg = {
                    visible: false,
                    constraintoviewport: true,
                    context: ["extracts", "bl", "tl"],
                    width: "auto",
                    dragOnly: true,
                    modal: true,
                    buttons: [
                        {
                            text: "OK",
                            handler: fOK,
                            isDefault: true
                        },
                        {
                            text: "Cancel",
                            handler: fCancel
                        }
                    ],
                    postmethod: "none"
                },
                oESCKeyListener = new YAHOO.util.KeyListener(
                    document,
                    {
                        keys: YAHOO.util.KeyListener.KEY.ESCAPE
                    },
                    {
                        fn: fCancel,
                        scope: oCustomPrompt,
                        correctScope: true
                    }
                ),
                // oEnterKeyListener = new YAHOO.util.KeyListener(
                //     document,
                //     {
                //         keys: YAHOO.util.KeyListener.KEY.ENTER
                //     },
                //     {
                //         fn: testy,
                //         scope: oCustomPrompt,
                //         correctScope: true
                //     }
                // ),
                fTurnRepeatOnOff = function () {
                    var oRepeat = document.getElementById("repeat");

                    if (oRepeat.checked) {
                        oRepeat.checked = false;
                    } else {
                        oRepeat.checked = true;
                    }
                },
                fTurnFullscreenOn = function () {
                    if(ytplayer){
                        //var video = document.getElementById("movie_player");
                        var video = document.querySelector('bideo')
                        if (video.msRequestFullscreen) {
                            video.msRequestFullscreen();
                        } 
                    }
                };

                oRKeyListener = new YAHOO.util.KeyListener(
                    document,
                    {
                        keys: 82
                    },
                    fTurnRepeatOnOff
                )
                oFKeyListener = new YAHOO.util.KeyListener(
                    document,
                    {
                        keys: 70
                    },
                    fTurnFullscreenOn
                )

                oCustomPrompt = new YAHOO.widget.Dialog(
                    "customPrompt",
                    oCustomPromptCfg
                )

                YAHOO.util.Event.addListener(window, "unload", function() {
					//if (ytplayer && pausePlayer()) {
                        ytplayer.getInternalPlayer().destroy();
					//}
				});
                
                oCustomPrompt.cfg.queueProperty("keylisteners", oESCKeyListener);
                //oCustomPrompt.cfg.queueProperty("keylisteners", oEnterKeyListener);
                oCustomPrompt.render();
                
                oRKeyListener.enable();
                oFKeyListener.enable();

                var aSelects = document.getElementsByTagName("select");

                for (i = 0, j = aSelects.length; i < j; i++) {
                    if (!aSelects[i].options.length) {
                        aSelects[i].disabled = true;
                    }
                }

                var inputElem = document.getElementById('startvideoat');
                inputElem.addEventListener('keydown', arrowListener, false);

                inputElem = document.getElementById('stopvideoat');
                inputElem.addEventListener('keydown', arrowListener, false);

                inputElem = document.getElementById('resumevideoat');
                inputElem.addEventListener('keydown', arrowListener, false);
            }

            function loadSoundcloudPlayer(){
                container = document.getElementById('bideo');
                url = "https://soundcloud.com/jaytechmusic/jaytech-xmas-beats-2020";
                //url = "https://video.vidyard.com/watch/aA7PedfQuCAeg69PYkJynj";
                var test = {url:url, 
                    playing:true,
                    controls:true,
                };
                renderReactPlayer(container, test);
            }

            function loadVidyardPlayer(){
                container = document.getElementById('bideo');
                //url = "https://soundcloud.com/jaytechmusic/jaytech-xmas-beats-2020";
                url = "https://video.vidyard.com/watch/aA7PedfQuCAeg69PYkJynj";
                var test = {url:url, 
                    playing:true,
                    controls:true,
                };
                renderReactPlayer(container, test);
            }

            function loadRawPlayer(){
                container = document.getElementById('bideo');
                url = "https://samplelib.com/lib/preview/mp4/sample-10s.mp4";
                var test = {url:url, 
                    playing:true,
                    controls:true,
                };
                renderReactPlayer(container, test);
            }

            function openEdge(){
                window.open('microsoft-edge' + ':' + document.location)
            }

            function prevElement(){
                callAjax("http://" + IPC_IP + ":" + IPC_PORT + "+" + "/element-back");
            }
            function beginLearning(){
                callAjax("http://" + IPC_IP + ":" + IPC_PORT + "+" + "/begin-learning");
            }
            function nextRep(){
                callAjax("http://" + IPC_IP + ":" + IPC_PORT + "+" + "/next-repetition");
            }
            function nextElement(){
                callAjax("http://" + IPC_IP + ":" + IPC_PORT + "+" + "/element-forward");
            }
            
            function loadPlayer(){
                console.log("player loaded")
                document.getElementById("videoid").value = oUrlQuery.videoid;
                document.getElementById("resumevideoat").value = oUrlQuery.resume;
                document.getElementById("startvideoat").value = oUrlQuery.start;
                document.getElementById("stopvideoat").value = oUrlQuery.stop;

                container = document.getElementById('bideo');
                //console.log(oUrlQuery.videoid);
                url = "http://www.youtube.com/v/" + oUrlQuery.videoid;
                var test = {url:url, 
                    playing:true,
                    //TODO add light toggle
                    //light:true,
                    controls:true,
                    onReady:handlePlayerReady,
                    onProgress:handleProgress,
                    onPause:handlePause,
                    onPlay:handlePlay,
                };

                renderReactPlayer(container, test);
            }
        </script>
    </body>
</html>
